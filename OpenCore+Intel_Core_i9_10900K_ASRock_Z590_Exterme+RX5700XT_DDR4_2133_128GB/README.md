
I've built a Big Sur machine, and I'll expose the record.

# Parts configuration

- https://www.amazon.co.jp/exec/obidos/ASIN/B08XNKH8JJ/nop-me-22/
- https://www.amazon.co.jp/exec/obidos/ASIN/B086MHSTVD/nop-me-22/
- https://www.amazon.co.jp/exec/obidos/ASIN/B07Y22PDBG/nop-me-22/
- https://www.amazon.co.jp/exec/obidos/ASIN/B08THM8YGY/nop-me-22/
- https://www.amazon.co.jp/exec/obidos/ASIN/B07Y4ZZ7LQ/nop-me-22/
- https://www.amazon.co.jp/exec/obidos/ASIN/B01JA8M75S/nop-me-22/
- https://www.amazon.co.jp/exec/obidos/ASIN/B072C956D7/nop-me-22/
- https://www.amazon.co.jp/exec/obidos/ASIN/B084SZFVK1/nop-me-22/

# Big Sur USB installer

[https://dortania.github.io/OpenCore-Install-Guide/installer-guide/mac-install.html#downloading-macos-modern-os:title] has the following description.

> CAUTION: With macOS 11.3 and newer, XhciPortLimit is broken resulting in boot loops (opens new window). We advise users either install an older OS (ie. macOS 10.15, Catalina) or find a 11.2.3 or older Big Sur installer

This is where I got stuck.... So, create a USB image of the macOS 11.2.3 installer.

[https://dortania.github.io/OpenCore-Install-Guide/installer-guide/mac-install.html#downloading-macos-modern-os:title] This is the procedure around here.

Specifically, you can run the following command. **Let's choose Big Sur 11.2.3. **

```
mkdir -p ~/macOS-installer && cd ~/macOS-installer && curl https://raw.githubusercontent.com/munki/macadmin-scripts/main/ installinstallmacos.py > installinstallmacos.py && sudo python installinstallmacos.py
````

A `dmg` file will be created in `~/macOS-Installer/`, mount it and copy `Install macOS Big Sur` to `/Applications`.

Create a USB installer as per the following steps.

[https://dortania.github.io/OpenCore-Install-Guide/installer-guide/mac-install.html#setting-up-the-installer:title]

## EFI region

- Use OC Configurator's Mount Tool or [https://dortania.github.io/OpenCore-Install-Guide/installer-guide/mac-install.html#setting-up-opencore -s-efi-environment:embed:title] tool to mount the EFI area of the USB flash drive.

- Follow [https://dortania.github.io/OpenCore-Install-Guide/installer-guide/opencore-efi.html:title] to create the EFI area as well.

The `Drivers` and `Kexts` are as follows.

- Drivers
    - HfsPlus.efi
    - OpenRuntime.efi
- Kexts
    - AppleALC.kext
    - IntelMauisi.kext
    - Lilu.kext
    - LucyRTL8125Ethernet.kext
    - SMCProcessor.kext
    - SMCSuperIO.kext
    - VirtualSMC.kext
    - WhateverGreen.kext

For `config.plist`, copy `Sample.plist` from `Docs` as `config.plist`. Details are below.

[https://dortania.github.io/OpenCore-Install-Guide/config.plist/:title]

Completed as a USB installer. Can also be installed.

## Temporarily remove the limit of 15 USB ports.

The OS can be installed, but there may be a problem with USB behavior. So, we will temporarily remove the 15 USB port limit.
This may be done after the OS has been installed once.

Place the following [USBInjectAll v0.7.7](https://gitee.com/softxing/OS-X-USB-Inject-All/releases/v0.7.7) in `EFI/OC/Kexts`.

[https://github.com/corpnewt/ProperTree:title], etc., and set `XhciPortLimit` in `config.plist` to `true` (**XhciPortLimit=true requires 11.2.3 (**Please note that XhciPortLimit=true requires 11.2.3 or earlier to avoid bootloop problems**).

Please refer to the following for specific instructions on which USB ports to select as 15.

[https://bootmacos.com/archives/12995:embed:cite]

I used Hackintool to set it up; the file generated by Hacktontool will be generated on your desktop and placed in the following location

- EFI/OC/ACPI/SSDT-EC-USBX.aml
- EFI/OC/ACPI/SSDT-UIAC.aml
- EFI/OC/Kexts/USBPorts.kext

Finally, please do the following

- Delete EFI/OC/Kexts/USBInjectAll.kext.
- **Set `XhciPortLimit` to `false` (otherwise you will have bootloop problems when upgrading to 11.3 or later)**.

Once you have mapped the USB ports, there seems to be no problem upgrading to 11.3 or later.

